<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>æ‰“åœ°é¼ å‡çº§ç‰ˆ</title>
<style>
body {
    margin: 0;
    background: #222;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
}
h2 {
    margin: 20px;
}
.scoreboard {
    display: flex;
    gap: 20px;
    font-size: 18px;
    margin-bottom: 10px;
}
#game {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 10px;
    width: 90vw;
    max-width: 400px;
}
.hole {
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* ä¿æŒæ­£æ–¹å½¢ */
    background: #555;
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
}
.mole {
    position: absolute;
    width: 70%;
    height: 70%;
    border-radius: 50%;
    bottom: -70%;
    left: 15%;
    transition: bottom 0.3s;
}
.mole.up { bottom: 10%; }
.mole.normal { background: brown; }
.mole.fast { background: red; }
.mole.slow { background: blue; }
button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    background: #333;
    color: #fff;
    cursor: pointer;
}
button:hover { background: #555; }
</style>
</head>
<body>

<h2>ğŸ¹ æ‰“åœ°é¼ å‡çº§ç‰ˆ</h2>
<div class="scoreboard">
    <div>å¾—åˆ†ï¼š<span id="score">0</span></div>
    <div>æ—¶é—´ï¼š<span id="time">30</span>s</div>
    <div>æœ€é«˜åˆ†ï¼š<span id="highscore">0</span></div>
</div>
<div id="game"></div>
<button id="restartBtn">é‡æ–°å¼€å§‹</button>

<audio id="hitSound" src="https://cdn.jsdelivr.net/gh/likerain/sounds/mole-hit.mp3" preload="auto"></audio>

<script>
const game = document.getElementById('game');
const scoreEl = document.getElementById('score');
const timeEl = document.getElementById('time');
const highScoreEl = document.getElementById('highscore');
const restartBtn = document.getElementById('restartBtn');
const hitSound = document.getElementById('hitSound');

let score = 0;
let highScore = localStorage.getItem('moleHigh') || 0;
highScoreEl.textContent = highScore;

const holes = [];
const numHoles = 9;
let lastHole;
let timeUp = false;
let gameTime = 30; // 30ç§’
let countdownInterval;

// åˆ›å»ºæ´å’Œåœ°é¼ 
for(let i=0;i<numHoles;i++){
    const hole = document.createElement('div');
    hole.classList.add('hole');
    const mole = document.createElement('div');
    mole.classList.add('mole', 'normal');
    hole.appendChild(mole);
    game.appendChild(hole);
    holes.push(hole);
}

// éšæœºé€‰æ‹©æ´
function randomHole(){
    const idx = Math.floor(Math.random()*holes.length);
    const hole = holes[idx];
    if(hole === lastHole) return randomHole();
    lastHole = hole;
    return hole;
}

// éšæœºåœ°é¼ ç±»å‹
function randomMoleType(){
    const r = Math.random();
    if(r < 0.6) return 'normal'; // æ™®é€š 60%
    else if(r < 0.85) return 'fast'; // å¿« 25%
    else return 'slow'; // æ…¢ 15%
}

// å¼¹å‡ºåœ°é¼ 
function popMole(){
    const timeMap = {normal:[500,1000], fast:[300,600], slow:[800,1500]};
    const hole = randomHole();
    const mole = hole.querySelector('.mole');
    const type = randomMoleType();
    mole.className = `mole ${type} up`;
    const popTime = Math.random()*(timeMap[type][1]-timeMap[type][0])+timeMap[type][0];

    setTimeout(()=>{
        mole.classList.remove('up');
        if(!timeUp) popMole();
    }, popTime);
}

// ç‚¹å‡»æ‰“åœ°é¼ 
holes.forEach(hole=>{
    hole.addEventListener('click', e=>{
        const mole = hole.querySelector('.mole');
        if(mole.classList.contains('up')){
            // åˆ†æ•°
            let type = 'normal';
            if(mole.classList.contains('fast')) type='fast';
            if(mole.classList.contains('slow')) type='slow';
            const points = type==='normal'?1:type==='fast'?2:3;
            score += points;
            scoreEl.textContent = score;

            // æ’­æ”¾å£°éŸ³
            hitSound.currentTime = 0;
            hitSound.play();

            mole.classList.remove('up');
        }
    });
});

// å€’è®¡æ—¶
function startTimer(){
    gameTime = 30;
    timeEl.textContent = gameTime;
    countdownInterval = setInterval(()=>{
        gameTime--;
        timeEl.textContent = gameTime;
        if(gameTime <= 0){
            timeUp = true;
            clearInterval(countdownInterval);
            if(score > highScore){
                highScore = score;
                localStorage.setItem('moleHigh', highScore);
                highScoreEl.textContent = highScore;
            }
            alert(`æ¸¸æˆç»“æŸï¼å¾—åˆ†ï¼š${score}`);
        }
    },1000);
}

// å¼€å§‹æ¸¸æˆ
function startGame(){
    score = 0;
    scoreEl.textContent = score;
    timeUp = false;
    popMole();
    startTimer();
}

// é‡æ–°å¼€å§‹æŒ‰é’®
restartBtn.addEventListener('click', ()=>{
    timeUp=true; // åœæ‰å½“å‰å¼¹å‡º
    setTimeout(()=>{
        startGame();
    },100); // ç¡®ä¿æ—§çš„ popMole åœæ‰
});

// è‡ªåŠ¨å¼€å§‹
startGame();
</script>
</body>
</html>